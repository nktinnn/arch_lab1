<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HelpDesk</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
<div id="app">

  <!-- Navigation -->
  <nav id="nav" style="display:none">
    <span class="nav-brand">HelpDesk</span>
    <div class="nav-links">
      <button data-page="tickets" id="nav-tickets">Обращения</button>
      <button data-page="admin" id="nav-admin" style="display:none">Пользователи</button>
      <span id="nav-username" style="color:var(--text-muted);font-size:0.85rem;padding:0 8px"></span>
      <button id="btn-logout">Выйти</button>
    </div>
  </nav>

  <main>

    <!-- ===================== AUTH ===================== -->
    <div id="page-auth" class="page">
      <div class="auth-card">
        <h2>HelpDesk</h2>
        <div class="auth-tabs">
          <button class="auth-tab active" data-tab="login">Вход</button>
          <button class="auth-tab" data-tab="register">Регистрация</button>
        </div>

        <!-- Login -->
        <div id="auth-form-login">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="login-email" placeholder="user@example.com"/>
          </div>
          <div class="form-group">
            <label>Пароль</label>
            <input type="password" id="login-password" placeholder="••••••••"/>
          </div>
          <button class="btn btn-primary btn-full" id="btn-login">Войти</button>
        </div>

        <!-- Register -->
        <div id="auth-form-register" style="display:none">
          <div class="form-group">
            <label>Имя пользователя</label>
            <input type="text" id="reg-username" placeholder="ivan"/>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="reg-email" placeholder="ivan@example.com"/>
          </div>
          <div class="form-group">
            <label>Пароль</label>
            <input type="password" id="reg-password" placeholder="••••••••"/>
          </div>
          <div class="form-group">
            <label>Роль</label>
            <select id="reg-role">
              <option value="user">user — пользователь</option>
              <option value="operator">operator — оператор</option>
              <option value="admin">admin — администратор</option>
            </select>
          </div>
          <button class="btn btn-primary btn-full" id="btn-register">Зарегистрироваться</button>
        </div>

        <div class="error-msg" id="auth-error"></div>
      </div>
    </div>

    <!-- ===================== TICKETS ===================== -->
    <div id="page-tickets" class="page">
      <div class="page-header">
        <h1>Обращения</h1>
        <button class="btn btn-primary" id="btn-new-ticket">+ Новое обращение</button>
      </div>

      <div class="filters">
        <label style="margin:0">Статус:</label>
        <select id="filter-status">
          <option value="">Все</option>
          <option value="open">Открыт</option>
          <option value="in_progress">В работе</option>
          <option value="resolved">Решён</option>
          <option value="closed">Закрыт</option>
        </select>
        <label style="margin:0">Приоритет:</label>
        <select id="filter-priority">
          <option value="">Все</option>
          <option value="low">Низкий</option>
          <option value="medium">Средний</option>
          <option value="high">Высокий</option>
          <option value="critical">Критический</option>
        </select>
      </div>

      <div class="tickets-grid" id="tickets-list">
        <div class="spinner">Загрузка...</div>
      </div>
    </div>

    <!-- ===================== TICKET DETAIL ===================== -->
    <div id="page-ticket-detail" class="page">
      <div id="ticket-detail-root"></div>
    </div>

    <!-- ===================== ADMIN ===================== -->
    <div id="page-admin" class="page">
      <div class="page-header">
        <h1>Управление пользователями</h1>
        <button class="btn btn-ghost btn-sm" onclick="loadAdminPage()">Обновить</button>
      </div>
      <div class="card table-wrap">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Имя</th>
              <th>Email</th>
              <th>Роль</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody id="users-tbody">
            <tr><td colspan="5" class="spinner">Загрузка...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </main>
</div>

<!-- ===================== MODAL: Создать тикет ===================== -->
<div class="modal-overlay" id="modal-create">
  <div class="modal">
    <button class="modal-close" id="modal-create-close">✕</button>
    <h3>Новое обращение</h3>
    <div class="form-group">
      <label>Заголовок</label>
      <input type="text" id="ct-title" placeholder="Кратко опишите проблему"/>
    </div>
    <div class="form-group">
      <label>Описание</label>
      <textarea id="ct-desc" placeholder="Подробно опишите суть обращения..."></textarea>
    </div>
    <div class="form-group">
      <label>Приоритет</label>
      <select id="ct-priority">
        <option value="low">Низкий</option>
        <option value="medium" selected>Средний</option>
        <option value="high">Высокий</option>
        <option value="critical">Критический</option>
      </select>
    </div>
    <div class="error-msg" id="ct-error"></div>
    <button class="btn btn-primary btn-full" id="btn-create-submit">Создать</button>
  </div>
</div>

<script src="js/api.js"></script>
<script src="js/auth.js"></script>
<script src="js/tickets.js"></script>
<script src="js/admin.js"></script>
<script src="js/app.js"></script>
</body>
</html>
